@model IEnumerable<MusicStore.Models.Song>

@{
	ViewBag.Title = "Index";
}

<h2>Index</h2>
Avg is: @Model.Average(s => s.Rate)

<p>
	@Html.ActionLink("Create New", "Create")
</p>
<table class="table">
	<tr>
		<th>
			@Html.DisplayNameFor(model => model.Name)
		</th>
		<th>
			@Html.DisplayNameFor(model => model.Artist)
		</th>
		<th>
			@Html.DisplayNameFor(model => model.Rate)
		</th>
		<th></th>
	</tr>

	@foreach (var item in Model)
	{
		<tr>
			<td>
				@Html.DisplayFor(modelItem => item.Name)
			</td>
			<td>
				@Html.DisplayFor(modelItem => item.Artist)
			</td>
			<td>
				<div data-id="@item.Id" class="rateit" data-rateit-value="@item.Rate" data-rateit-resetable="false"
					 data-rateit-step="1">
				</div>
			</td>
			<td>
				@Html.ActionLink("Download", "Download", new { id = item.Id }) |
				@Html.ActionLink("Edit", "Edit", new { id = item.Id }) |
				@Html.ActionLink("Details", "Details", new { id = item.Id }) |
				@Html.ActionLink("Delete", "Delete", new { id = item.Id })
			</td>
		</tr>
	}

</table>

@section Scripts {
	<script>

		$(document).on('click', '.rateit', function (e) {
			var ri = $(this);
			var value = ri.rateit('value');
			var ID = ri.data('id');

			//zapytanie do serwera
			$.ajax({
				url: '/Songs/RateIt',			//url obsługujący oceny
				data: { id: ID, value: value },	//dane przesyłane
				type: 'POST',					//typ zapytania
				success: function (data) {		//callback w przypadku sukcesu (HTTP 2xx)

				},
				error: function (jxhr, msg, err) {	//callback w przypadku błędu
					alert('Error');
				}
			});
		});
	</script>

}